<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<HotKeyLink version="2" accessibility="Public" >

<Function namespace="Extensions.TbMailer.TbMailer.ProspectiveSupplierAddress" localize="Prospective Supplier's address" type="string">
  <Param name="localized_StartCode" type="string" localize="From Prospective Supplier" value="From code" optional="true"/>
  <Param name="localized_EndCode" type="string" localize="To Prospective Supplier" value="To code" optional="true"/>
</Function>

  <!-- Syntax allows comma separated db tables, the first is the hkl master table -->
  <DbTable name="MA_ProspectiveSuppliers" loadFullRecord="false" /> 
  <DbField name="MA_ProspectiveSuppliers.CompanyName"/>
  <DbFieldDescription name="MA_ProspectiveSuppliers.ProspectiveSupplier" />

  <Events>
    
    <Event name="OnAssignSelectedValue" type="bool">
      <Param name="p_CtrlValue" type="string" localize="Control value" mode="in out" />
      <Param name="p_HklValue" type="string" localize="Selected value" />
      <TbScript>
        <![CDATA[ 
        Begin
              if p_CtrlValue != ''
                then p_CtrlValue = p_CtrlValue + ';' + p_HklValue;
                else p_CtrlValue = p_HklValue;
        End
      ]]>
      </TbScript>
    </Event>
  </Events>
  
  <AskRules>
    <![CDATA[ 
    Variables 
      String ask_StartCode [15,1] Alias 1 Hidden Input Init = "" ; 
      String ask_EndCode [15,1] Alias 2 Hidden Input Init = "" ; 
    End
    Dialogs Begin 
      Dialog AskProspectiveSuppliers "" 
      Begin 
         Controls Begin 
            Begin 
              ask_StartCode Prompt = (GetTitle("localized_StartCode")) LowerLimit HotLink ERP.Contacts.Dbl.ProspectiveSuppliers () ; 
              ask_EndCode Prompt = (GetTitle("localized_EndCode")) UpperLimit HotLink ERP.Contacts.Dbl.ProspectiveSuppliers () ; 
            End 
         End 
      End 
    End     
   ]]>
  </AskRules>

  <SelectionModes>
 
    <Mode name="Default" type="query">
  <![CDATA[  
SELECT 
     ProspectiveSupplier  { COL MA_ProspectiveSuppliers.ProspectiveSupplier }
     ,CompanyName         { COL MA_ProspectiveSuppliers.CompanyName }
     ,Fax               { COL MA_ProspectiveSuppliers.Fax }
     ,Address             { COL MA_ProspectiveSuppliers.Address }
     ,ZIPCode             { COL MA_ProspectiveSuppliers.ZIPCode }
     ,City                { COL MA_ProspectiveSuppliers.City }
     ,County              { COL MA_ProspectiveSuppliers.County }
     ,Country             { COL MA_ProspectiveSuppliers.Country }
     ,ContactPerson       { COL MA_ProspectiveSuppliers.ContactPerson }
     ,Notes               { COL MA_ProspectiveSuppliers.Notes }
     ,Disabled            { COL MA_ProspectiveSuppliers.Disabled }
     ,ISOCountryCode      { COL MA_ProspectiveSuppliers.ISOCountryCode }     
     ,1 as sort           
  FROM MA_ProspectiveSuppliers
  WHERE 
   ProspectiveSupplier BETWEEN { IN ask_StartCode } AND  { IN ask_EndCode }
   
UNION SELECT 
	ProspectiveSupplier {+} '-' {+} Branch AS ProspectiveSupplier 
    ,CompanyName 
    ,Fax
    ,Address
    ,ZIPCode
    ,City
    ,County
    ,Country  
    ,ContactPerson
    ,Notes
    ,Disabled
    ,ISOCountryCode          
	  ,3 as sort
  FROM MA_ProspectiveSuppBranches 
  WHERE 
   MA_ProspectiveSuppBranches.ProspectiveSupplier BETWEEN { IN ask_StartCode } AND  { IN ask_EndCode }
  
UNION SELECT 
	  MA_ProspectiveSuppPeople.ProspectiveSupplier {+} '-' {+} MA_ProspectiveSuppPeople.Branch AS ProspectiveSupplier
    ,'>' {+} MA_ProspectiveSuppPeople.Name 
    ,MA_ProspectiveSuppPeople.Fax 
    ,{ WHEN GetDatabaseType () != "ORACLE" EXPAND { IsNull } ELSE { NVL }} (MA_ProspectiveSuppBranches.Address, MA_ProspectiveSuppliers.Address) AS Address
    ,{ WHEN GetDatabaseType () != "ORACLE" EXPAND { IsNull } ELSE { NVL }} (MA_ProspectiveSuppBranches.ZIPCode, MA_ProspectiveSuppliers.ZIPCode) AS ZIPCode
    ,{ WHEN GetDatabaseType () != "ORACLE" EXPAND { IsNull } ELSE { NVL }} (MA_ProspectiveSuppBranches.City, MA_ProspectiveSuppliers.City) AS City
    ,{ WHEN GetDatabaseType () != "ORACLE" EXPAND { IsNull } ELSE { NVL }} (MA_ProspectiveSuppBranches.County, MA_ProspectiveSuppliers.County) AS County
    ,{ WHEN GetDatabaseType () != "ORACLE" EXPAND { IsNull } ELSE { NVL }} (MA_ProspectiveSuppBranches.Country, MA_ProspectiveSuppliers.Country) AS Country  
    ,WorkingPosition 
    ,MA_ProspectiveSuppPeople.Notes 
    ,{FALSE} AS Disabled
    ,{ WHEN GetDatabaseType () != "ORACLE" EXPAND { IsNull } ELSE { NVL }} (MA_ProspectiveSuppBranches.ISOCountryCode, MA_ProspectiveSuppliers.ISOCountryCode) AS ISOCountryCode  
	  ,{ WHEN GetDatabaseType ( ) != "ORACLE" 
        EXPAND { CASE MA_ProspectiveSuppPeople.Branch WHEN '' THEN 2 ELSE 4 END  }
        ELSE { Decode( MA_ProspectiveSuppPeople.Branch, '', 2, ' ', 2, 4) }
      } AS sort
  FROM (
    MA_ProspectiveSuppliers INNER JOIN MA_ProspectiveSuppPeople 
    ON 
      MA_ProspectiveSuppliers.ProspectiveSupplier = MA_ProspectiveSuppPeople.ProspectiveSupplier AND
      MA_ProspectiveSuppliers.ProspectiveSupplier BETWEEN { IN ask_StartCode } AND { IN ask_EndCode }
  )
  LEFT OUTER JOIN MA_ProspectiveSuppBranches
  ON  
	  MA_ProspectiveSuppPeople.ProspectiveSupplier = MA_ProspectiveSuppBranches.ProspectiveSupplier AND
	  MA_ProspectiveSuppPeople.Branch = MA_ProspectiveSuppBranches.Branch 
  ORDER BY 1, sort
 ]]>
  </Mode>

</SelectionModes>

</HotKeyLink>