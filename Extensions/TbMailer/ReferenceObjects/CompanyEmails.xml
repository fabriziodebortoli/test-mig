<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<HotKeyLink version="2" accessibility="Public" >

<Function namespace="Extensions.TbMailer.TbMailer.CompanyEmails" localize="Company's email address" type="string">
</Function>

  <!-- Syntax allows comma separated db tables, the first is the hkl master table -->
  <DbTable name="MA_Company"  loadFullRecord="false" /> 
  <DbField name="MA_Company.Email"/>
  <DbFieldDescription name="MA_Company.CompanyName" />

  <Events>
    <Event name="IsValid" type="bool">
      <TbScript>
        <![CDATA[ 
        Begin
              return MA_Company.EMail != '';
        End
       ]]>
      </TbScript>
    </Event>
    <Event name="OnAssignSelectedValue" type="bool">
      <Param name="p_CtrlValue" type="string" localize="Control value" mode="in out" />
      <Param name="p_HklValue" type="string" localize="Selected value" />
      <TbScript>
        <![CDATA[ 
        Begin
              if p_CtrlValue != ''
                then p_CtrlValue = p_CtrlValue + ';' + p_HklValue;
                else p_CtrlValue = p_HklValue;
        End
      ]]>
      </TbScript>
    </Event>
  </Events>
  

  <SelectionModes>
 
    <Mode name="Default" type="query">
  <![CDATA[  
SELECT 
     CompanyName          { COL MA_Company.CompanyName }
     ,EMail               { COL MA_Company.EMail }
     ,Address             { COL MA_Company.Address }
     ,ZIPCode             { COL MA_Company.ZIPCode }
     ,City                { COL MA_Company.City }
     ,County              { COL MA_Company.County }
     ,Country             { COL MA_Company.Country }
     ,1 as sort           
 FROM MA_Company
  
UNION SELECT 
	   
    Branch {+} '-' {+} CompanyName 
    ,EMail
    ,Address
    ,ZIPCode
    ,City
    ,County
    ,Country  
 	 ,2 as sort
  FROM MA_CompanyBranches 
  WHERE EMail <> {''}
    
 UNION SELECT 
    Name {+} '-' {+} LastName
    ,EMail 
    ,DomicileAddress
    ,DomicileZIP
    ,DomicileCity
    ,DomicileCounty
    ,{''} as Country  
 	  ,3 AS sort
  FROM MA_CompanyPeople 
  WHERE EMail <> {''}
 
 UNION SELECT 
    CompanyName 
    ,EMailAddress
    ,Address
    ,ZIPCode
    ,City
    ,County
    ,Country  
 	  ,4 as sort
  FROM MA_CompanyGroups 
  WHERE EMailAddress <> {''}

UNION SELECT 
	 Company {+} '-' {+} Name {+} '-' {+} LastName 
    ,EMailAddress
    ,{''} as Address
    ,{''} as ZIPCode
    ,{''} as City
    ,{''} as County
    ,{''} as Country  
 	  ,5 as sort
  FROM MA_CompanyGroupPeople 
  WHERE EMailAddress <> {''}
 
 UNION SELECT 
    Branch {+} '-' {+} Description
    ,EMail 
    ,DomicilyAddress
    ,DomicilyZIP
    ,DomicilyCity
    ,DomicilyCounty
    ,{''} As Country  
 	  ,6 AS sort
  FROM RM_Resources 
  WHERE EMail <> {''}

 UNION SELECT 
    Name  {+} '-' {+} LastName 
    ,EMail 
    ,DomicilyAddress
    ,DomicilyZIP
    ,DomicilyCity
    ,DomicilyCounty
    ,DomicilyCountry  
 	,7 AS sort
  FROM RM_Workers 
  WHERE EMail <> {''}

  ORDER BY sort, 1
 ]]>
  </Mode>

</SelectionModes>

</HotKeyLink>