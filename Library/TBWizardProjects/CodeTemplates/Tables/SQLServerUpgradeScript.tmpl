@(IfIsPrimaryKeyToModify{@(ApplyToPreviousTableVersion{@(+)
ALTER TABLE [dbo].[@(TableName)]\n@(+)
\tDROP CONSTRAINT [@(TablePrimaryKeyConstraintName)]\n@(+)
GO\n\n@(+)
})})@(+)
@(IfAreForeignKeysToDrop{@(RepeatOnForeignKeysToDrop{@(+)
if exists (select dbo.sysobjects.name from dbo.sysobjects where dbo.sysobjects.name = '@(ConstraintName)')\n@(+)
ALTER TABLE [dbo].[@(TableName)]\n@(+)
\tDROP CONSTRAINT [@(ConstraintName)]\n@(+)
GO\n\n@(+)
})})@(+)
@(IfAreColumnsToAdd{@(+)
if not exists (select dbo.syscolumns.name from dbo.syscolumns, dbo.sysobjects\n@(+)
where dbo.sysobjects.name = '@(TableName)' and dbo.sysobjects.id = dbo.syscolumns.id and\n@(+)
(@(RepeatOnAddedColumns{dbo.syscolumns.name = '@(ColumnName)', " or "})))\n@(+)
ALTER TABLE [dbo].[@(TableName)]\n@(+)
\tADD\n@(+)
@(RepeatOnAddedColumns{\t\t[@(ColumnName)] @(ColumnDBFullDataType) @(ColumnDBNullableAttribute)@(IfHasDefaultValue{ CONSTRAINT @(ColumnDefaultConstraintName) DEFAULT(@(ColumnDBDefaultValue))}), ",\r\n"})\n@(+)
GO\n\n@(+)
})@(+)
@(IfAreColumnsToAlter{@(+)
@(RepeatOnColumnsToAlter{@(IfHasDefaultValue{@(+)
if exists (select dbo.sysobjects.name from dbo.sysobjects where dbo.sysobjects.name = '@(ColumnDefaultConstraintName)')\n@(+)
ALTER TABLE [dbo].[@(TableName)]\n@(+)
\tDROP CONSTRAINT [@(ColumnDefaultConstraintName)]\n@(+)
GO\n\n@(+)
})})@(+)
@(RepeatOnAlteredColumns{ALTER TABLE [dbo].[@(TableName)]\n\tALTER COLUMN\n\t\t[@(ColumnName)] @(ColumnDBFullDataType) @(ColumnDBNullableAttribute)\n@(IfHasDefaultValue{\nALTER TABLE [dbo].[@(TableName)]\n\tADD CONSTRAINT @(ColumnDefaultConstraintName) DEFAULT(@(ColumnDBDefaultValue)) FOR [@(ColumnName)]\n}), "\r\n"})\n@(+)
@(RepeatOnDefaultChangedColumns{@(IfHasDefaultValue{\nUPDATE [dbo].[@(TableName)] SET [dbo].[@(TableName)].[@(ColumnName)] = @(ColumnDBDefaultValue)\n\tWHERE [dbo].[@(TableName)].[@(ColumnName)] IS @(ApplyToPreviousVersion(@(IfIsNotEnumType(NULL))@(IfIsEnumType(@(ColumnDBDefaultValue)))))})\n, ",\r\n"})@(+)
GO\n\n})@(+)
@(IfAreColumnsRenamed{@(+)
@(RepeatOnRenamedColumns{UPDATE [dbo].[@(TableName)] SET [dbo].[@(TableName)].[@(ColumnName)] = [dbo].[@(TableName)].[@(ApplyToPreviousVersion(@(ColumnName)))]\n, "\r\n"})@(+)
GO\n\n})@(+)
@(IfAreColumnsToDrop{@(+)
@(RepeatOnDroppedColumns{@(ApplyToPreviousVersion{@(IfHasDefaultValue{@(+)
if exists (select dbo.sysobjects.name from dbo.sysobjects where dbo.sysobjects.name = '@(ColumnDefaultConstraintName)')\n@(+)
ALTER TABLE [dbo].[@(TableName)]\n@(+)
\tDROP CONSTRAINT [@(ColumnDefaultConstraintName)]\n@(+)
})}), "\r\n"})@(+)
@(RepeatOnDroppedColumns{@(+)
\nif exists (select dbo.syscolumns.name from dbo.syscolumns, dbo.sysobjects where dbo.sysobjects.name = '@(TableName)' and dbo.sysobjects.id = dbo.syscolumns.id and dbo.syscolumns.name = '@(ColumnName)')\n@(+)
ALTER TABLE [dbo].[@(TableName)]\n@(+)
\tDROP COLUMN [@(ColumnName)]\n@(+)
, "\r\n"})@(+)
GO\n\n@(+)
})@(+)
@(IfPrimaryKeyDefined{@(IfIsPrimaryKeyToModify{@(+)
ALTER TABLE [dbo].[@(TableName)]\n@(+)
\tADD CONSTRAINT [@(TablePrimaryKeyConstraintName)] PRIMARY KEY NONCLUSTERED (\n@(+)
@(RepeatOnPrimaryKeySegments{\t\t[@(ColumnName)], ",\r\n"})\n@(+)
\t)ON [PRIMARY]\n@(+)
GO\n@(+)
})})@(+)
@(IfAreForeignKeysToAdd{@(RepeatOnForeignKeysToAdd{@(+)
if not exists (select dbo.sysobjects.name from dbo.sysobjects where dbo.sysobjects.name = '@(ConstraintName)')\n@(+)
ALTER TABLE [dbo].[@(TableName)]\n@(+)
\tADD CONSTRAINT [@(ConstraintName)] FOREIGN KEY (\n@(+)
@(RepeatOnForeignKeySegments{\t\t[@(ColumnName)], ",\r\n"})\n@(+)
\t) REFERENCES [dbo].[@(ReferencedTableName)] (\n@(+)
\t\t@(RepeatOnForeignKeySegments{[@(ReferencedColumnName)], ",\r\n"})\n@(+)
\t)\n@(+)
GO\n\n@(+)
})})
