<div class="login-flex-container">
    <header>
        <mat-toolbar color="primary">
            <img src="assets/images/logoM4_h40.png" />
            <span class="fill"></span>
            <span id="microarea">Microarea Spa</span>
        </mat-toolbar>
    </header>

    <div class="login-main-content">
        <div class="login-form tb-card" *ngIf="!loadingService.isLoading">
            <tb-card>
                <tb-card-title [title]="localizationService?.localizedElements?.Login"></tb-card-title>
                <tb-card-content>

                    <div class="form-group">

                        <div class="form-control">
                            <p class="floatingLabel">{{localizationService?.localizedElements?.User}}</p>
                            <kendo-textbox-container>
                                <input kendoTextBox autofocus [(ngModel)]="connectionData.user" (blur)=getCompaniesForUser(connectionData.user) (keyup)="keyUpFunction($event)"
                                    name="user">
                            </kendo-textbox-container>
                        </div>

                        <div class="form-control">
                            <p class="floatingLabel">{{localizationService?.localizedElements?.Password}}</p>
                            <kendo-textbox-container class="form-control-k">
                                <input kendoTextBox [(ngModel)]="connectionData.password" (keyup)="keyUpFunction($event)" name="password" type="password">
                            </kendo-textbox-container>
                        </div>

                        <div class="form-control">
                            <p class="floatingLabel">{{localizationService?.localizedElements?.CompanyLabel}}</p>
                            <kendo-dropdownlist [data]="companies" [(ngModel)]="connectionData.company"></kendo-dropdownlist>
                        </div>

                        <mat-checkbox [ngModel]="clearCachedData" (ngModelChange)="clearCachedData=$event">{{localizationService?.localizedElements?.ClearCachedData}}</mat-checkbox>

                        <div class="error" *ngIf="authService.errorMessage">{{authService.errorMessage}}</div>

                        <button class="form-button" mat-raised-button color="primary" (click)="login();" [disabled]="companies.length == 0">Login</button>
                    </div>
                </tb-card-content>
            </tb-card>
        </div>
    </div>

    <footer>
        <span>Copyright Â© 1984-2017 Microarea SpA - Tutti i diritti riservati |
            <a href="http://www.microarea.it">Microarea.it</a>
        </span>
    </footer>
</div>
<tb-loading></tb-loading>

<!-- USER ALREADY LOGGED -->
<kendo-dialog title="{{localizationService?.localizedElements?.UserAlreadyConnectedTitle}}" *ngIf="userAlreadyConnectedOpened"
    (close)="userConnectedCancel()">
    <div>
        {{localizationService?.localizedElements?.UserAlreadyConnected}}
    </div>
    <kendo-dialog-actions>
        <button kendoButton (click)="userConnectedYes()" [primary]="true">{{localizationService?.localizedElements?.Yes}}</button>
        <button kendoButton (click)="userConnectedCancel()">{{localizationService?.localizedElements?.Cancel}}</button>
    </kendo-dialog-actions>
</kendo-dialog>

<!-- CHANGE PASSWORD -->
<kendo-dialog title="{{localizationService?.localizedElements?.ChangePassword}}" *ngIf="changePasswordOpened" (close)="userConnectedCancel()">
    <div class="form-group">
        {{localizationService?.localizedElements?.UserMustChangePassword}}
        <div class="form-control">
            <p class="floatingLabel">{{localizationService?.localizedElements?.Password}}</p>
            <kendo-textbox-container class="form-control-k">
                <input kendoTextBox [(ngModel)]="newPassword" (keyup)="keyUpFunction($event)" name="password" type="password">
            </kendo-textbox-container>
        </div>

        <div class="form-control">
            <p class="floatingLabel">{{localizationService?.localizedElements?.ConfirmPassword}}</p>
            <kendo-textbox-container class="form-control-k">
                <input kendoTextBox [(ngModel)]="confirmPassword" (keyup)="keyUpFunction($event)" name="confirmPassword" type="password">
            </kendo-textbox-container>
        </div>

        <div class="error" *ngIf="(newPassword && confirmPassword) &&  confirmPassword != newPassword">{{localizationService?.localizedElements?.PasswordsNotMatching}}</div>
    </div>
    <kendo-dialog-actions>
        <button kendoButton (click)="changePasswordOk()" [primary]="true">{{localizationService?.localizedElements?.Ok}}</button>
    </kendo-dialog-actions>
</kendo-dialog>